<!DOCTYPE html>
<html>
<head>
    <title>Hospital Management System</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f6f8; margin: 0; }
        header { background: #2c3e50; color: white; padding: 10px; text-align: center; }
        .container { max-width: 700px; margin: auto; padding: 20px; }
        button, input, select { padding: 8px; margin: 5px; width: 100%; }
        .card { background: white; padding: 15px; margin: 10px 0; border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
    </style>
</head>
<body>
    <header>
        <h1>Hospital Management</h1>
    </header>
    <div class="container" id="app"></div>

    <script>
        const backendURL = "https://hospital-backend-r1uz.onrender.com"; 
        const appDiv = document.getElementById("app");
        let currentUser = null, currentRole = null;

        function landingPage(){
            appDiv.innerHTML = `<button onclick="showLogin()">Enter</button>`;
        }

        function showLogin(){
            appDiv.innerHTML = `
                <h3>Login</h3>
                <select id="role">
                    <option value="patient">Patient</option>
                    <option value="doctor">Doctor</option>
                    <option value="staff">Staff</option>
                </select>
                <input id="email" placeholder="Email">
                <input id="password" type="password" placeholder="Password">
                <button onclick="login()">Login</button>
                <p><a href="#" onclick="showRegister()">New user? Register here</a></p>
            `;
        }

        function showRegister(){
            appDiv.innerHTML = `
                <h3>Register</h3>
                <select id="role">
                    <option value="patient">Patient</option>
                    <option value="doctor">Doctor</option>
                    <option value="staff">Staff</option>
                </select>
                <input id="name" placeholder="Name">
                <input id="email" placeholder="Email">
                <input id="password" type="password" placeholder="Password">
                <button onclick="register()">Register</button>
                <p><a href="#" onclick="showLogin()">Back to login</a></p>
            `;
        }

        async function register(){
            const role = document.getElementById("role").value;
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            let res = await fetch(`${backendURL}/register`, {
                method: "POST", headers: {"Content-Type": "application/json"},
                body: JSON.stringify({role, name, email, password})
            });
            let data = await res.json();
            alert(data.message);
            showLogin();
        }

        async function login(){
            const role = document.getElementById("role").value;
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            let res = await fetch(`${backendURL}/login`, {
                method: "POST", headers: {"Content-Type": "application/json"},
                body: JSON.stringify({role, email, password})
            });
            let data = await res.json();
            if(data.error){ alert(data.error); return; }
            currentUser = data.user;
            currentRole = role;
            dashboard();
        }

        function dashboard(){
            if(currentRole === "patient"){
                appDiv.innerHTML = `
                    <h3>Patient Dashboard</h3>
                    <div class="card">Name: ${currentUser.name}</div>
                    <div class="card"><button onclick="viewDoctors()">View Doctors</button></div>
                    <div class="card"><button onclick="viewBills()">View Bills</button></div>
                    <div class="card"><button onclick="viewAppointments()">My Appointments</button></div>
                    <button onclick="landingPage()">Logout</button>
                `;
            } else if(currentRole === "doctor"){
                appDiv.innerHTML = `
                    <h3>Doctor Dashboard</h3>
                    <div class="card"><button onclick="viewPatients()">View Patients</button></div>
                    <div class="card"><button onclick="viewAppointments()">View Appointments</button></div>
                    <button onclick="landingPage()">Logout</button>
                `;
            } else if(currentRole === "staff"){
                appDiv.innerHTML = `
                    <h3>Staff Dashboard</h3>
                    <div class="card"><button onclick="viewAppointments()">Manage Appointments</button></div>
                    <div class="card"><button onclick="viewBills()">Generate Bills</button></div>
                    <button onclick="landingPage()">Logout</button>
                `;
            }
        }

        async function viewDoctors(){
            let res = await fetch(`${backendURL}/doctors`);
            let docs = await res.json();
            appDiv.innerHTML = `<h3>Doctors</h3>` + docs.map((d,i)=>`
                <div class="card">
                    ${d.name} - ${d.email}
                    <button onclick="bookAppointment('${d.name}')">Book Appointment</button>
                </div>`).join("") + `<button onclick="dashboard()">Back</button>`;
        }

        async function viewPatients(){
            let res = await fetch(`${backendURL}/patients`);
            let pts = await res.json();
            appDiv.innerHTML = `<h3>Patients</h3>` + pts.map(p=>`
                <div class="card">${p.name} - ${p.email}</div>
            `).join("") + `<button onclick="dashboard()">Back</button>`;
        }

        async function bookAppointment(doctor){
            let patient = currentUser.name;
            let date = prompt("Enter date (YYYY-MM-DD):");
            let time = prompt("Enter time:");
            let res = await fetch(`${backendURL}/appointments`, {
                method: "POST", headers: {"Content-Type": "application/json"},
                body: JSON.stringify({patient_name: patient, doctor_name: doctor, date, time})
            });
            let data = await res.json();
            alert(data.message);
            dashboard();
        }

        async function viewAppointments(){
            let res = await fetch(`${backendURL}/appointments`);
            let appts = await res.json();
            appDiv.innerHTML = `<h3>Appointments</h3>` + appts.map((a,i)=>`
                <div class="card">
                    ${a.patient_name} with ${a.doctor_name} on ${a.date} at ${a.time}
                    <a href="${backendURL}/download_appointment/${i}" target="_blank">Download PDF</a>
                </div>`).join("") + `<button onclick="dashboard()">Back</button>`;
        }

        async function viewBills(){
            let res = await fetch(`${backendURL}/bills`);
            let all = await res.json();
            appDiv.innerHTML = `<h3>Bills</h3>` + all.map((b,i)=>`
                <div class="card">
                    ${b.patient_name} - Total: ${b.total}
                    <a href="${backendURL}/download_bill/${i}" target="_blank">Download PDF</a>
                </div>`).join("") + `<button onclick="dashboard()">Back</button>`;
        }

        landingPage();
    </script>
</body>
</html>
